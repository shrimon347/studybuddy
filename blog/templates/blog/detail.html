{% extends "main.html" %}

{% block content %}
<main id="main" role="main" class=" layout layout--2">

    <div class="container">
        
            <!-- Content of the page -->
           <div>
            <article >
                <!-- Post Block of the page -->
                <div class="">
                    <div class="">
                        <div class="detail--img">
                            <img src="{{post.image.url}}" alt="image description">
                        </div>
                       <div class="post-time">
                        <time datetime="2011-01-12" >{{post.created|date:"d M"}} - {{post.category}}</time>
                       </div>
                        <h2 class="post-title">{{post.title}}</h2>
                        <div class="post-content">
                            <p >{{post.content|safe}}</p>
                        </div>
                        {% if user.is_authenticated and post.writer == request.user %} 
                        
                        <div style="display: flex; gap: 2rem;">
                            <a href="{% url "update" post.slug %}"><input type="submit"  class="btn btn--main" value = 'Update'></a>
                            <a href="{% url "delete" post.slug %}"><input type="submit"  class="btn btn--main" value = 'Delete'></a>
                        </div>
                        {% endif %}
                        
                    
                       
                    </div>
                </div>
                <div class="post-comment-box"> {% if blog_comments %}
                    <div style="height:500px;">
                        <div class="room__conversation ">
                            <div class="threads scroll" style="margin-top: 0px">
                                {% for comment in blog_comments %}
                              <div class="thread" >
                                <div class="thread__top">
                                  <div class="thread__author">
                                    <a
                                      href="{% url 'user-profile' comment.user.id %}"
                                      class="thread__authorInfo"
                                    >
                                      <div class="avatar avatar--small">
                                        <img src="{{comment.user.avatar.url}}" />
                                      </div>
                                      <span>@{{comment.user.username}}</span>
                                    </a>
                                    <span class="thread__date"
                                      >{{comment.created|timesince}} ago</span
                                    >
                                  </div>
                  
                                  {% if request.user == comment.user %}
                                  <a href="{% url 'delete-comment' comment.id %}">
                                    <div class="thread__delete">
                                      <svg
                                        version="1.1"
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="32"
                                        height="32"
                                        viewBox="0 0 32 32"
                                      >
                                        <title>remove</title>
                                        <path
                                          d="M27.314 6.019l-1.333-1.333-9.98 9.981-9.981-9.981-1.333 1.333 9.981 9.981-9.981 9.98 1.333 1.333 9.981-9.98 9.98 9.98 1.333-1.333-9.98-9.98 9.98-9.981z"
                                        ></path>
                                      </svg>
                                    </div>
                                  </a>
                                  {% endif %}
                                </div>
                                <div class="thread__details">{{comment.comment}}</div>
                              </div>
                              {% endfor %}
                            </div>
                          </div>
                        <div>
                        
                    </div>
                    {% endif %}
                </div>
                {% if request.user.is_authenticated %}
                <div class="form">
                    <form action="" method="POST">
                      {% csrf_token %}
                      <div class="form__group" >    
                        
                        <div class="form__action" style="display:flex;">
                            <input name="body" style="" placeholder="Write your comment here..." />
                            <button class="btn btn--main" type="submit">Comment</button>
                        </div>
                      </div>
                     
                      
                    </form>
                  </div>
                {% endif %}
                
            </article> 
           </div>
            
            <div class="roomList">
                {% for post in posts %}
                  <div class="roomListRoom">
                    
                        <div class="roomList__header">
                          <a href="{% url "detail" post.slug %}" class="blogListRoom__author">
                            <div>
                              <span class="blog-title">{{post.title}}</span>
                              {{post.content|safe|truncatechars:300}} read more
                              <div class="blogListRoom__actions">
                                 Publised : {{post.created|date:"d M"}}
                              </div>
                             </div>
                          </a>
                          
                        </div>
                      <div class="roomListRoom__content">
                          <a href="{% url 'user-profile' post.writer.username %}" style="color:black; font-size:20px">Author : @{{post.writer.username}}</a>
                          <span style="margin-left:20px; font-size:15px;">( {{post.created|timesince}} ago )</span>
                      </div>
                      <div class="roomListRoom__meta">
                           
                          <p class="roomListRoom__topic">Category : {{post.category}}</p>
                      </div>
                  </div>
                  {% endfor %}
                </div>
    </div>
    
</main>
{% endblock content %}